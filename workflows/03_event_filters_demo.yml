name: 03. Event Filters Demo

# ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ í•„í„° ì˜ˆì œë“¤
on:
  # 1. ê¸°ë³¸ push ì´ë²¤íŠ¸ (ëª¨ë“  ë¸Œëœì¹˜)
  push:
    branches: [main, develop, feature/*]
    paths:
      - "src/**"
      - "public/**"
      - "package.json"
      - "package-lock.json"
      - "!docs/**" # docs í´ë”ëŠ” ì œì™¸

  # 2. Pull Request ì´ë²¤íŠ¸
  pull_request:
    branches: [main, develop]
    types: [opened, synchronize, reopened, closed]
    paths:
      - "src/**"
      - "public/**"
      - "package.json"

  # 3. ìˆ˜ë™ ì‹¤í–‰ (workflow_dispatch)
  workflow_dispatch:

jobs:
  # 1. ì´ë²¤íŠ¸ ì •ë³´ ì¶œë ¥
  event-info:
    name: ì´ë²¤íŠ¸ ì •ë³´ ì¶œë ¥
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Display event information
        run: |
          echo "=== ì´ë²¤íŠ¸ ì •ë³´ ==="
          echo "ì´ë²¤íŠ¸ íƒ€ì…: ${{ github.event_name }}"
          echo "ë¸Œëœì¹˜: ${{ github.ref_name }}"
          echo "ì»¤ë°‹: ${{ github.sha }}"
          echo "ì‹¤í–‰ì: ${{ github.actor }}"
          echo "ì›Œí¬í”Œë¡œìš°: ${{ github.workflow }}"
          echo "ì‹¤í–‰ ID: ${{ github.run_id }}"

      # Pull Request ì •ë³´ ì¶œë ¥
      - name: Display PR information
        if: github.event_name == 'pull_request'
        run: |
          echo "=== Pull Request ì •ë³´ ==="
          echo "PR ë²ˆí˜¸: ${{ github.event.pull_request.number }}"
          echo "PR ì œëª©: ${{ github.event.pull_request.title }}"
          echo "PR ìƒíƒœ: ${{ github.event.pull_request.state }}"
          echo "PR ì‘ì„±ì: ${{ github.event.pull_request.user.login }}"
          echo "PR ì•¡ì…˜: ${{ github.event.action }}"

      # Workflow Dispatch ì •ë³´ ì¶œë ¥
      - name: Display workflow dispatch info
        if: github.event_name == 'workflow_dispatch'
        run: |
          echo "=== ìˆ˜ë™ ì‹¤í–‰ ì •ë³´ ==="
          echo "ìˆ˜ë™ ì‹¤í–‰ë¨"
          echo "ì‹¤í–‰ì: ${{ github.actor }}"

  # 2. ë¸Œëœì¹˜ë³„ ë‹¤ë¥¸ ë™ì‘
  branch-specific:
    name: ë¸Œëœì¹˜ë³„ ë™ì‘
    runs-on: ubuntu-latest
    needs: event-info

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # main ë¸Œëœì¹˜ ì „ìš©
      - name: Main branch actions
        if: github.ref_name == 'main'
        run: |
          echo "ğŸ¯ Main ë¸Œëœì¹˜ ì „ìš© ì‘ì—…"
          echo "í™˜ê²½: PRODUCTION"
          echo "ë°°í¬ ì¤€ë¹„ ì¤‘..."

      # develop ë¸Œëœì¹˜ ì „ìš©
      - name: Develop branch actions
        if: github.ref_name == 'develop'
        run: |
          echo "ğŸ”§ Develop ë¸Œëœì¹˜ ì „ìš© ì‘ì—…"
          echo "í™˜ê²½: STAGING"
          echo "ìŠ¤í…Œì´ì§• í™˜ê²½ ë°°í¬ ì¤€ë¹„ ì¤‘..."

      # feature ë¸Œëœì¹˜ ì „ìš©
      - name: Feature branch actions
        if: startsWith(github.ref_name, 'feature/')
        run: |
          echo "ğŸš€ Feature ë¸Œëœì¹˜ ì „ìš© ì‘ì—…"
          echo "í™˜ê²½: FEATURE"
          echo "ê¸°ëŠ¥: ${{ github.ref_name }}"
          echo "ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸ ì¤‘..."

  # 3. ì´ë²¤íŠ¸ íƒ€ì…ë³„ ì²˜ë¦¬
  event-type-handling:
    name: ì´ë²¤íŠ¸ íƒ€ì…ë³„ ì²˜ë¦¬
    runs-on: ubuntu-latest
    needs: event-info

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # Push ì´ë²¤íŠ¸ ì²˜ë¦¬
      - name: Handle push event
        if: github.event_name == 'push'
        run: |
          echo "ğŸ“¤ Push ì´ë²¤íŠ¸ ì²˜ë¦¬"
          echo "ì»¤ë°‹ ë©”ì‹œì§€: ${{ github.event.head_commit.message }}"
          echo "ì»¤ë°‹ ì‘ì„±ì: ${{ github.event.head_commit.author.name }}"

      # Pull Request ì´ë²¤íŠ¸ ì²˜ë¦¬
      - name: Handle pull request event
        if: github.event_name == 'pull_request'
        run: |
          echo "ğŸ“ Pull Request ì´ë²¤íŠ¸ ì²˜ë¦¬"
          echo "PR ë²ˆí˜¸: ${{ github.event.pull_request.number }}"
          echo "PR ì œëª©: ${{ github.event.pull_request.title }}"
          echo "PR ì•¡ì…˜: ${{ github.event.action }}"

      # Workflow Dispatch ì´ë²¤íŠ¸ ì²˜ë¦¬
      - name: Handle workflow dispatch event
        if: github.event_name == 'workflow_dispatch'
        run: |
          echo "ğŸ‘† ìˆ˜ë™ ì‹¤í–‰ ì´ë²¤íŠ¸ ì²˜ë¦¬"
          echo "ìˆ˜ë™ìœ¼ë¡œ ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤"

  # 4. ì¡°ê±´ë¶€ ì‘ì—… ì‹¤í–‰
  conditional-tasks:
    name: ì¡°ê±´ë¶€ ì‘ì—… ì‹¤í–‰
    runs-on: ubuntu-latest
    needs: [event-info, branch-specific, event-type-handling]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # main ë¸Œëœì¹˜ + push ì´ë²¤íŠ¸ ì‹œì—ë§Œ ì‹¤í–‰
      - name: Production deployment
        if: github.ref_name == 'main' && github.event_name == 'push'
        run: |
          echo "ğŸš€ Production ë°°í¬ ì‹¤í–‰"
          echo "ë©”ì¸ ë¸Œëœì¹˜ì— í‘¸ì‹œë˜ì–´ ë°°í¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤"

      # Pull Request + main ë¸Œëœì¹˜ ì‹œì—ë§Œ ì‹¤í–‰
      - name: PR review checks
        if: github.event_name == 'pull_request' && github.event.pull_request.base.ref == 'main'
        run: |
          echo "ğŸ” Main ë¸Œëœì¹˜ PR ë¦¬ë·° ì²´í¬"
          echo "ì½”ë“œ ë¦¬ë·° ìš”êµ¬ì‚¬í•­ í™•ì¸ ì¤‘..."

  # 5. ì›Œí¬í”Œë¡œìš° ìš”ì•½
  summary:
    name: ì›Œí¬í”Œë¡œìš° ìš”ì•½
    runs-on: ubuntu-latest
    needs: [event-info, branch-specific, event-type-handling, conditional-tasks]
    # if: always() - ë‹¤ë¥¸ jobë“¤ì´ ì‹¤íŒ¨í•´ë„ í•­ìƒ ì‹¤í–‰ë˜ë„ë¡ í•˜ëŠ” ì¡°ê±´
    if: always()

    steps:
            - name: Generate workflow summary
        run: |
          echo "=== ì›Œí¬í”Œë¡œìš° ìš”ì•½ ==="
          echo "ì´ë²¤íŠ¸: ${{ github.event_name }}"
          echo "ë¸Œëœì¹˜: ${{ github.ref_name }}"
          echo "ì‹¤í–‰ì: ${{ github.actor }}"

      - name: Final status
        run: |
          echo "ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì™„ë£Œ"
