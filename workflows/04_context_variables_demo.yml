name: 04. Context Variables Demo

# ê°„ë‹¨í•œ ì´ë²¤íŠ¸ ì„¤ì •
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  # 1. ê¸°ë³¸ Context ë³€ìˆ˜ ì•Œì•„ë³´ê¸°
  basic-context:
    name: ê¸°ë³¸ Context ë³€ìˆ˜
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: GitHub Context ì¶œë ¥í•˜ê¸°
        run: |
          echo "=== GitHub Context ë³€ìˆ˜ë“¤ ==="
          echo "ì €ì¥ì†Œ ì´ë¦„: ${{ github.repository }}"
          echo "ë¸Œëœì¹˜ ì´ë¦„: ${{ github.ref_name }}"
          echo "ì»¤ë°‹ í•´ì‹œ: ${{ github.sha }}"
          echo "ì´ë²¤íŠ¸ íƒ€ì…: ${{ github.event_name }}"
          echo "ì‹¤í–‰ì: ${{ github.actor }}"

      - name: Runner Context ì¶œë ¥í•˜ê¸°
        run: |
          echo "=== Runner Context ë³€ìˆ˜ë“¤ ==="
          echo "ìš´ì˜ì²´ì œ: ${{ runner.os }}"
          echo "ì‘ì—… ë””ë ‰í† ë¦¬: ${{ runner.workspace }}"

  # 2. ë¸Œëœì¹˜ë³„ ë‹¤ë¥¸ ë™ì‘í•˜ê¸°
  branch-specific:
    name: ë¸Œëœì¹˜ë³„ ë™ì‘
    runs-on: ubuntu-latest
    needs: basic-context

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Main ë¸Œëœì¹˜ ì‘ì—…
        if: github.ref_name == 'main'
        run: |
          echo "ğŸ¯ Main ë¸Œëœì¹˜ì—ì„œ ì‹¤í–‰ ì¤‘"
          echo "ì´ê³³ì—ì„œëŠ” ë°°í¬ ì‘ì—…ì„ í•©ë‹ˆë‹¤"

      - name: Develop ë¸Œëœì¹˜ ì‘ì—…
        if: github.ref_name == 'develop'
        run: |
          echo "ğŸ”§ Develop ë¸Œëœì¹˜ì—ì„œ ì‹¤í–‰ ì¤‘"
          echo "ì´ê³³ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ ì‘ì—…ì„ í•©ë‹ˆë‹¤"

      - name: ë‹¤ë¥¸ ë¸Œëœì¹˜ ì‘ì—…
        if: github.ref_name != 'main' && github.ref_name != 'develop'
        run: |
          echo "ğŸš€ ${{ github.ref_name }} ë¸Œëœì¹˜ì—ì„œ ì‹¤í–‰ ì¤‘"
          echo "ì´ê³³ì—ì„œëŠ” ê°œë°œ ì‘ì—…ì„ í•©ë‹ˆë‹¤"

  # 3. ì´ë²¤íŠ¸ë³„ ë‹¤ë¥¸ ë™ì‘í•˜ê¸°
  event-specific:
    name: ì´ë²¤íŠ¸ë³„ ë™ì‘
    runs-on: ubuntu-latest
    needs: basic-context

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Push ì´ë²¤íŠ¸ ì²˜ë¦¬
        if: github.event_name == 'push'
        run: |
          echo "ğŸ“¤ Push ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"
          echo "ì»¤ë°‹ ë©”ì‹œì§€: ${{ github.event.head_commit.message }}"

      - name: Pull Request ì´ë²¤íŠ¸ ì²˜ë¦¬
        if: github.event_name == 'pull_request'
        run: |
          echo "ğŸ“ Pull Request ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"
          echo "PR ì œëª©: ${{ github.event.pull_request.title }}"
          echo "PR ë²ˆí˜¸: ${{ github.event.pull_request.number }}"

      - name: ìˆ˜ë™ ì‹¤í–‰ ì²˜ë¦¬
        if: github.event_name == 'workflow_dispatch'
        run: |
          echo "ğŸ‘† ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤"
          echo "ì‹¤í–‰ì: ${{ github.actor }}"

  # 4. Steps Context ì‚¬ìš©í•˜ê¸°
  steps-context:
    name: Steps Context ì‚¬ìš©
    runs-on: ubuntu-latest
    needs: basic-context

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: ì •ë³´ ìƒì„±í•˜ê¸°
        id: build_info
        run: |
          echo "build_time=$(date)" >> $GITHUB_OUTPUT
          echo "branch=${{ github.ref_name }}" >> $GITHUB_OUTPUT
          echo "commit=${{ github.sha }}" >> $GITHUB_OUTPUT

      - name: ìƒì„±ëœ ì •ë³´ ì‚¬ìš©í•˜ê¸°
        run: |
          echo "=== ìƒì„±ëœ ì •ë³´ ==="
          echo "ë¹Œë“œ ì‹œê°„: ${{ steps.build_info.outputs.build_time }}"
          echo "ë¸Œëœì¹˜: ${{ steps.build_info.outputs.branch }}"
          echo "ì»¤ë°‹: ${{ steps.build_info.outputs.commit }}"

  # 6. ì¡°ê±´ë¶€ ì‹¤í–‰ ì—°ìŠµ
  conditional-execution:
    name: ì¡°ê±´ë¶€ ì‹¤í–‰ ì—°ìŠµ
    runs-on: ubuntu-latest
    needs: [basic-context, branch-specific, event-specific]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Main ë¸Œëœì¹˜ + Push ì´ë²¤íŠ¸
        if: github.ref_name == 'main' && github.event_name == 'push'
        run: |
          echo "ğŸš€ Main ë¸Œëœì¹˜ì— í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤!"
          echo "ë°°í¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."

      - name: Develop ë¸Œëœì¹˜ + Push ì´ë²¤íŠ¸
        if: github.ref_name == 'develop' && github.event_name == 'push'
        run: |
          echo "ğŸ”§ Develop ë¸Œëœì¹˜ì— í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤!"
          echo "í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."

      - name: Pull Request ì´ë²¤íŠ¸
        if: github.event_name == 'pull_request'
        run: |
          echo "ğŸ“ Pull Requestê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!"
          echo "ì½”ë“œ ë¦¬ë·°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."

  # 6. ìš”ì•½
  summary:
    name: Context Variables ìš”ì•½
    runs-on: ubuntu-latest
    needs: [basic-context, branch-specific, event-specific, steps-context, conditional-execution]
    # if: always() - ë‹¤ë¥¸ jobë“¤ì´ ì‹¤íŒ¨í•´ë„ í•­ìƒ ì‹¤í–‰ë˜ë„ë¡ í•˜ëŠ” ì¡°ê±´
    if: always()

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: í•™ìŠµí•œ Context ë³€ìˆ˜ë“¤
        run: |
          echo "=== ì˜¤ëŠ˜ í•™ìŠµí•œ Context ë³€ìˆ˜ë“¤ ==="
          echo "1. github.repository - ì €ì¥ì†Œ ì´ë¦„"
          echo "2. github.ref_name - ë¸Œëœì¹˜ ì´ë¦„"
          echo "3. github.sha - ì»¤ë°‹ í•´ì‹œ"
          echo "4. github.event_name - ì´ë²¤íŠ¸ íƒ€ì…"
          echo "5. github.actor - ì‹¤í–‰ì"
          echo "6. steps.{id}.outputs.{name} - ë‹¨ê³„ ê°„ ë°ì´í„° ì „ë‹¬"
          echo ""
          echo "=== í˜„ì¬ ì‹¤í–‰ ì •ë³´ ==="
          echo "ì €ì¥ì†Œ: ${{ github.repository }}"
          echo "ë¸Œëœì¹˜: ${{ github.ref_name }}"
          echo "ì´ë²¤íŠ¸: ${{ github.event_name }}"
          echo "ì‹¤í–‰ì: ${{ github.actor }}"
