name: Test and Deploy

# Workflowê°€ ì‹¤í–‰ë  ì¡°ê±´
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

# ì‹¤í–‰í•  ì‘ì—…ë“¤
jobs:
  # í…ŒìŠ¤íŠ¸ ì‘ì—…
  test:
    runs-on: ubuntu-latest

    steps:
      # 1ë‹¨ê³„: ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout code
        uses: actions/checkout@v4

      # 2ë‹¨ê³„: Node.js ì„¤ì •
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      # 3ë‹¨ê³„: ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install dependencies
        run: npm ci

      # 4ë‹¨ê³„: ë¦°íŠ¸ ê²€ì‚¬
      - name: Run linting
        run: npm run lint

      # 5ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      - name: Run tests
        run: npm run test

      # 6ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì‹¤í–‰
      - name: Run test coverage
        run: npm run test:coverage

      # 7ë‹¨ê³„: ë¹Œë“œ í…ŒìŠ¤íŠ¸
      - name: Build application
        run: npm run build

  deploy:
    # needs: test # test ì‘ì—…ì´ ì„±ê³µí•´ì•¼ ì‹¤í–‰
    runs-on: ubuntu-latest

    steps:
      # 1ë‹¨ê³„: ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout code
        uses: actions/checkout@v4

      # 2ë‹¨ê³„: Node.js ì„¤ì •
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      # 3ë‹¨ê³„: ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install dependencies
        run: npm ci

      # 4ë‹¨ê³„: í”„ë¡œë•ì…˜ ë¹Œë“œ
      - name: Build for production
        run: npm run build

      # 5ë‹¨ê³„: ë°°í¬ ì‹œë®¬ë ˆì´ì…˜
      - name: Simulate deployment
        run: echo "ğŸš€ Simulating deployment to production..."
