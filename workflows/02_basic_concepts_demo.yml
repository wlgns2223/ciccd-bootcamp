name: 02. Basic CI Demo

# ì´ë²¤íŠ¸ ì •ì˜ - ì–¸ì œ ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë ì§€
on: [push, workflow_dispatch] # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

# ì „ì—­ í™˜ê²½ë³€ìˆ˜ ì„¤ì •
env:
  NODE_ENV: production
  PROJECT_NAME: "GitHub Actions CI Demo"

# ì‘ì—…ë“¤ ì •ì˜
jobs:
  # ì²« ë²ˆì§¸ ì‘ì—…: ì½”ë“œ ì²´í¬ì•„ì›ƒ ë° ì˜ì¡´ì„± ì„¤ì¹˜
  setup:
    name: í™˜ê²½ ì„¤ì •
    runs-on: ubuntu-latest

    steps:
      # Step 1: ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Node.js ì„¤ì •
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      # Step 3: ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install dependencies
        run: npm ci

      # Step 4: ì„¤ì¹˜ í™•ì¸
      - name: Check installed packages
        run: |
          echo "=== ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€ í™•ì¸ ==="
          echo "Node.js ë²„ì „: $(node --version)"
          echo "npm ë²„ì „: $(npm --version)"
          echo "ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€ ìˆ˜: $(npm list --depth=0 | wc -l)"

  # ë‘ ë²ˆì§¸ ì‘ì—…: ì½”ë“œ ê²€ì‚¬
  lint:
    name: ì½”ë“œ ê²€ì‚¬
    runs-on: ubuntu-latest
    needs: setup

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      # ESLint ì‹¤í–‰
      - name: Run ESLint
        run: npm run lint

  # ì„¸ ë²ˆì§¸ ì‘ì—…: í…ŒìŠ¤íŠ¸ ì‹¤í–‰
  test:
    name: í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    runs-on: ubuntu-latest
    needs: setup

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      - name: Run tests
        run: npm test

      # í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í™•ì¸
      - name: Check test coverage
        run: npm run test:coverage

  # ë„¤ ë²ˆì§¸ ì‘ì—…: ë¹Œë“œ
  build:
    name: ë¹Œë“œ
    runs-on: ubuntu-latest
    needs: [lint, test]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      # ë¹Œë“œ ì‹¤í–‰
      - name: Build application
        run: npm run build

      # ë¹Œë“œ ê²°ê³¼ í™•ì¸
      - name: Check build output
        run: |
          echo "=== ë¹Œë“œ ê²°ê³¼ í™•ì¸ ==="
          echo "ë¹Œë“œëœ íŒŒì¼ë“¤:"
          ls -la dist/
          echo "ë¹Œë“œ í¬ê¸°:"
          du -sh dist/

  # ë‹¤ì„¯ ë²ˆì§¸ ì‘ì—…: CI ê²°ê³¼ ìš”ì•½
  summary:
    name: CI ê²°ê³¼ ìš”ì•½
    runs-on: ubuntu-latest
    needs: [lint, test, build]

    steps:
      - name: Generate CI summary
        run: |
          echo "ğŸ‰ CI íŒŒì´í”„ë¼ì¸ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
          echo ""
          echo "=== ì‹¤í–‰ëœ ì‘ì—…ë“¤ ==="
          echo "âœ… í™˜ê²½ ì„¤ì •: Node.js ì„¤ì • ë° ì˜ì¡´ì„± ì„¤ì¹˜"
          echo "âœ… ì½”ë“œ ê²€ì‚¬: ESLint"
          echo "âœ… í…ŒìŠ¤íŠ¸ ì‹¤í–‰: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° ì»¤ë²„ë¦¬ì§€ í™•ì¸"
          echo ""
          echo "=== ë‹¤ìŒ ë‹¨ê³„ ==="
          echo "ğŸš€ ë°°í¬ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì§„í–‰í•˜ê±°ë‚˜"
          echo "ğŸ“‹ ì½”ë“œ ë¦¬ë·°ë¥¼ ì§„í–‰í•˜ì„¸ìš”!"
